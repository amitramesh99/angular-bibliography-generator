var app=angular.module("main",[]);app.controller("AppCtrl",["$scope","$http",function(e,t){var a=["January","February","March","April","May","June","July","August","September","October","November","December"];e.searches=[],e.userInput="",e.getBib=function(){for(i=0;i<e.searches.length;i++)"failed"===e.searches[i].status&&(e.searches.splice(i,1),console.log("failed"));e.newSearch={title:"Loading...",bibliography:"",status:"pending"},e.searches.unshift(e.newSearch),e.userInput.indexOf("wikipedia.org/wiki/")>-1?(e.inputTitle=e.userInput.substring(e.userInput.lastIndexOf("/")+1),console.log(e.pageTitle),e.pageTitle=e.inputTitle.replace(new RegExp("_","g"),"%20"),e.APIUrl="https://en.wikipedia.org/w/api.php?action=query&titles="+e.pageTitle+"&prop=revisions&rvprop=timestamp&format=json",t.get(e.APIUrl).success(function(t){console.log(t),e.retrivedData=t.query.pages,e.retrivedData.hasOwnProperty("-1")?e.searches[0].title="404":(e.retrivedDataIndex=Object.keys(e.retrivedData),1===e.retrivedDataIndex.length?(e.title=e.retrivedData[e.retrivedDataIndex[0]].title,e.lastEditTimestampISO=new Date(e.retrivedData[e.retrivedDataIndex[0]].revisions[0].timestamp),e.lastEditTimestamp=e.lastEditTimestampISO.getDate()+" "+a[e.lastEditTimestampISO.getMonth()]+" "+e.lastEditTimestampISO.getFullYear(),e.retriveTimestampISO=new Date,e.retriveTimestamp=e.retriveTimestampISO.getDate()+" "+a[e.retriveTimestampISO.getMonth()]+" "+e.retriveTimestampISO.getFullYear(),e.bibliography='"'+e.title+'." Wikipedia: The Free Encyclopedia. Wikimedia Foundation, Inc.  '+e.lastEditTimestamp+". Web. "+e.retriveTimestamp,e.includeUrl===!0&&(e.bibliography=e.bibliography+" <"+e.userInput+">"),e.newSearch={title:e.title,bibliography:e.bibliography},e.searches[0]=e.newSearch,e.searches[0].status="success"):console.log(e.retrivedData),document.getElementById("userInput").select())}).error(function(){e.searches[0].title="Unable to reach to API. Check your internet connection.",e.searches[0].status="failed"})):""===e.userInput?e.searches[0].status="failed":(e.bibliography="That doesn't look like a wikipedia URL",e.searches[0].title=e.bibliography,e.searches[0].status="failed",document.getElementById("userInput").select())},e.copyToClipBoard=function(){element.select(),document.execcommand("copy"),alert("copied")},e.remove=function(t){e.searches.splice(t,1)}}]);
